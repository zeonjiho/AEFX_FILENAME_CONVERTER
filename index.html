<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AEFX Filename Converter</title>
    <!-- Google Fonts 불러오기 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <!-- Inter, Source Code Pro, Archivo 폰트 포함 -->
    <link href="https://fonts.googleapis.com/css2?family=Archivo&family=Inter:wght@400;600&family=Source+Code+Pro&display=swap" rel="stylesheet">
    <style>
        /* Reset CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* 테마를 위한 루트 변수 */
        :root {
            --bg-color: #ffffff;
            --text-color: #333333;
            --input-bg: #f0f0f0;
            --input-border: #cccccc;
            --button-bg: #e0e0e0;
            --button-bg-hover: #d0d0d0;
            --button-text-color: #333333;
            --highlight-color: #666666;
            --hover-color: #000000;
        }

        [data-theme="dark"] {
            --bg-color: #000000;
            --text-color: #f0f0f0;
            --input-bg: #1a1a1a;
            --input-border: #333333;
            --button-bg: #333333;
            --button-bg-hover: #4d4d4d;
            --button-text-color: #f0f0f0;
            --highlight-color: #999999;
            --hover-color: #ffffff;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        h2 {
            text-align: center;
            color: var(--text-color);
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 600;
            /* 폰트 변경 */
            font-family: 'Archivo', sans-serif;
        }

        /* 버전 정보 */
        .version-info {
            text-align: center;
            font-size: 0.9em;
            color: var(--text-color);
            margin-bottom: 30px;
            font-family: 'Source Code Pro', monospace;
        }

        #template-example {
            background-color: var(--input-bg);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            font-family: 'Source Code Pro', monospace;
            color: var(--text-color);
            border-left: 5px solid var(--highlight-color);
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
            box-sizing: border-box;
        }

        /* 프리셋 버튼 */
        #preset-buttons {
            text-align: center;
            margin-bottom: 20px;
        }

        #preset-buttons p {
            margin-bottom: 10px;
            font-weight: 600;
        }

        .presets-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }

        .preset-button {
            width: 40px;
            height: 40px;
            background-color: var(--button-bg);
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 600;
            color: var(--button-text-color);
            cursor: pointer;
            transition: background 0.3s, color 0.3s;
            position: relative;
        }

        .preset-button:hover {
            background-color: var(--button-bg-hover);
        }

        /* 선택된 프리셋 버튼 */
        .selected-preset {
            background-color: #FFFFFF;
            color: #000000;
        }

        /* 프리셋 툴팁 */
        .preset-tooltip {
            display: none;
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--input-bg);
            color: var(--text-color);
            padding: 10px;
            border: 1px solid var(--input-border);
            border-radius: 6px;
            font-size: 0.9em;
            font-family: 'Source Code Pro', monospace;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
            z-index: 1000;
        }

        .preset-button:hover .preset-tooltip {
            display: block;
            opacity: 1;
        }

        /* 프리셋 메시지 */
        #preset-message {
            margin-top: 10px;
            text-align: center;
            font-size: 1em;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        /* 프리셋 추가/제거 버튼 */
        #add-remove-buttons {
            text-align: center;
            margin-bottom: 20px;
        }

        .add-remove-button {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.5em;
            font-weight: 600;
            cursor: pointer;
            transition: color 0.3s;
            margin: 0 5px;
        }

        .add-remove-button:hover {
            color: var(--highlight-color);
        }

        /* 폼 컨테이너 */
        .form-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .input-group {
            position: relative;
            transition: transform 0.2s;
        }

        .input-group:hover {
            transform: translateY(-5px);
        }

        label {
            font-weight: 600;
            display: block;
            margin-bottom: 8px;
            color: var(--text-color);
            font-size: 1em;
        }

        input[type="text"], select, input[type="number"] {
            width: 100%;
            padding: 12px 15px;
            background-color: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 6px;
            font-size: 1em;
            color: var(--text-color);
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        input[type="text"]:focus, select:focus, input[type="number"]:focus {
            border-color: var(--highlight-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 102, 102, 0.2);
        }

        /* 변환 및 리셋 버튼 */
        #convert-button-container {
            text-align: center;
            margin-top: 50px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }

        #convert-button, #save-preset-button, .reset-button {
            padding: 10px 20px;
            background: var(--button-bg);
            color: var(--button-text-color);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: background 0.3s, transform 0.2s;
        }

        #convert-button:hover, #save-preset-button:hover {
            background: var(--button-bg-hover);
        }

        #convert-button:active, #save-preset-button:active {
            transform: scale(0.98);
        }

        /* 프리셋 저장 버튼 */
        #save-preset-button {
            background-color: #4CAF50;
            color: #FFFFFF;
        }

        #save-preset-button:hover {
            background-color: #45A049;
        }

        /* 리셋 버튼 */
        .reset-button {
            background-color: var(--button-bg);
            color: var(--button-text-color);
        }

        .reset-button:hover {
            background-color: #FF0000;
            color: #FFFFFF;
        }

        /* 결과 컨테이너 */
        #result-container {
            margin-top: 40px;
            text-align: center;
        }

        #result {
            display: inline-block;
            padding: 20px;
            background-color: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 6px;
            font-family: 'Source Code Pro', monospace;
            font-size: 1.2em;
            color: var(--text-color);
            position: relative;
            transition: transform 0.2s;
            min-width: 300px;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
            box-sizing: border-box;
        }

        #result:hover {
            transform: translateY(-5px);
        }

        #copy-message {
            display: none;
            margin-top: 20px;
            color: var(--highlight-color);
            font-size: 1em;
            text-align: center;
            animation: fadeOut 2s forwards;
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* 테마 전환 버튼 */
        .theme-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1em;
            cursor: pointer;
            color: var(--text-color);
            transition: color 0.3s;
            z-index: 1000;
            font-family: 'Source Code Pro', monospace;
        }

        .theme-toggle:hover {
            color: var(--hover-color);
        }

        @media (max-width: 600px) {
            .form-container {
                grid-template-columns: 1fr;
            }

            h2 {
                font-size: 2em;
            }

            #convert-button, #save-preset-button, .reset-button {
                width: 100%;
            }

            .presets-container {
                gap: 5px;
            }

            .preset-button {
                width: 35px;
                height: 35px;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>AEFX Filename Converter</h2>
        <div class="version-info">Alpha 1.0.2
        </div>
        
        <div id="template-example">
            Example: &lt;projectName&gt;_&lt;product&gt;_&lt;cutName&gt;_&lt;colorspace&gt;_&lt;xResolution&gt;x&lt;yResolution&gt;_&lt;productType&gt;_&lt;founder&gt;_&lt;versionState&gt;_&lt;version&gt;.####
        </div>

        <!-- 프리셋 버튼 -->
        <div id="preset-buttons">
            <div class="presets-container" id="presets-container">
                <!-- 프리셋 버튼이 동적으로 추가됩니다 -->
            </div>
            <div id="add-remove-buttons">
                <button class="add-remove-button" id="add-preset-button">+</button>
                <button class="add-remove-button" id="remove-preset-button">-</button>
            </div>
            <div id="preset-message"></div> <!-- 메시지 표시 영역 -->
        </div>
        
        <!-- 폼 필드 -->
        <div class="form-container">
            <!-- 입력 필드 -->
            <div class="input-group">
                <label for="projectName">Project Name</label>
                <input type="text" id="projectName" placeholder="Enter project name" pattern="[A-Za-z0-9 ]+" title="영어와 숫자만 입력 가능합니다.">
            </div>
    
            <div class="input-group">
                <label for="product">Product</label>
                <input type="text" id="product" placeholder="Enter product name" pattern="[A-Za-z0-9 ]+" title="영어와 숫자만 입력 가능합니다.">
            </div>
    
            <div class="input-group">
                <label for="cut_name">Cut Name</label>
                <input type="text" id="cut_name" placeholder="Enter cut name" pattern="[A-Za-z0-9 ]+" title="영어와 숫자만 입력 가능합니다.">
            </div>
    
            <div class="input-group">
                <label for="colorspace">Color Space</label>
                <select id="colorspace">
                    <option value="srgb">sRGB</option>
                    <option value="rec709">Rec. 709</option>
                    <option value="acescg">ACEScg</option>
                    <option value="ap0">AP0</option>
                    <option value="ap1">AP1</option>
                    <option value="logC3">ARRI LogC3</option>
                    <option value="logC4">ARRI LogC4</option>
                    <option value="slog3">Sony S-Log3</option>
                    <option value="linear">Linear</option>
                    <option value="raw">Raw</option>
                </select>
            </div>
    
            <div class="input-group">
                <label for="x_resolution">X Resolution</label>
                <input type="number" id="x_resolution" placeholder="e.g., 1920" min="1">
            </div>
    
            <div class="input-group">
                <label for="y_resolution">Y Resolution</label>
                <input type="number" id="y_resolution" placeholder="e.g., 1080" min="1">
            </div>
    
            <div class="input-group">
                <label for="product_type">Product Type</label>
                <select id="product_type">
                    <option value="cgi">CGI</option>
                    <option value="comp">Comp</option>
                </select>
            </div>
    
            <div class="input-group">
                <label for="founder">Founder</label>
                <input type="text" id="founder" placeholder="Enter founder's name" pattern="[A-Za-z ]+" title="영어만 입력 가능합니다.">
            </div>
    
            <div class="input-group">
                <label for="version-state">Version State</label>
                <select id="version-state">
                    <option value="prev">Preview</option>
                    <option value="final">Final</option>
                </select>
            </div>

            <div class="input-group">
                <label for="version">Version</label>
                <input type="number" id="version" placeholder="Enter version number" min="1" value="1">
            </div>
        </div>
    
        <!-- 변환 및 리셋 버튼 -->
        <div id="convert-button-container">
            <button id="save-preset-button" onclick="saveCurrentToPreset()">Save Preset</button>
            <button id="convert-button" onclick="convertAndCopy()">
                Convert &amp; Copy
            </button>
            <button class="reset-button" onclick="resetCurrentPreset()">Reset Preset</button>
            <button class="reset-button" onclick="resetAllData()">Reset All</button>
        </div>
        
        <!-- 결과 컨테이너 -->
        <div id="result-container">
            <div id="result">
                <!-- 결과가 여기에 표시됩니다 -->
            </div>
            <div id="copy-message">복사가 완료되었습니다</div>
        </div>
    </div>

    <!-- 테마 전환 버튼 -->
    <button class="theme-toggle" id="theme-toggle" title="Toggle Theme">
        <!-- 텍스트는 동적으로 업데이트됩니다 -->
    </button>

    <script>
        // 프리셋 번호 관리
        let currentPresetNumber = 1;
        let totalPresets = 1;
        const maxPresets = 15;

        // 프리셋 초기화
        const presetsContainer = document.getElementById('presets-container');

        function initializePresets() {
            presetsContainer.innerHTML = '';
            for (let i = 1; i <= totalPresets; i++) {
                createPresetButton(i);
            }
            updateCurrentPresetDisplay();
        }

        function createPresetButton(presetNumber) {
            let button = document.createElement('button');
            button.className = 'preset-button';
            button.textContent = presetNumber;
            button.onclick = function() { loadPreset(presetNumber); };
            button.onmouseover = function() { showTooltip(presetNumber); };
            button.onmouseout = function() { hideTooltip(presetNumber); };
            button.id = 'preset-button-' + presetNumber;

            let tooltip = document.createElement('div');
            tooltip.className = 'preset-tooltip';
            tooltip.id = 'tooltip-' + presetNumber;

            button.appendChild(tooltip);
            presetsContainer.appendChild(button);
            updateTooltip(presetNumber);
        }

        // 현재 프리셋 표시 업데이트
        function updateCurrentPresetDisplay() {
            // 모든 버튼에서 'selected-preset' 클래스 제거
            for (let i = 1; i <= totalPresets; i++) {
                const button = document.getElementById('preset-button-' + i);
                if (button) {
                    button.classList.remove('selected-preset');
                }
            }

            // 현재 버튼에 'selected-preset' 클래스 추가
            const currentButton = document.getElementById('preset-button-' + currentPresetNumber);
            if (currentButton) {
                currentButton.classList.add('selected-preset');
            }
        }

        // 프리셋 추가
        document.getElementById('add-preset-button').addEventListener('click', function() {
            if (totalPresets < maxPresets) {
                totalPresets++;
                createPresetButton(totalPresets);

                // 현재 프리셋의 데이터를 새로운 프리셋에 복사 (버전 번호 제외)
                let currentData = {
                    projectName: document.getElementById('projectName').value,
                    product: document.getElementById('product').value,
                    cut_name: document.getElementById('cut_name').value,
                    colorspace: document.getElementById('colorspace').value,
                    x_resolution: document.getElementById('x_resolution').value,
                    y_resolution: document.getElementById('y_resolution').value,
                    product_type: document.getElementById('product_type').value,
                    founder: document.getElementById('founder').value,
                    version_state: document.getElementById('version-state').value,
                    version_prev: 1, // version_prev를 1로 설정
                    version_final: 1 // version_final을 1로 설정
                };
                localStorage.setItem('preset' + totalPresets, JSON.stringify(currentData));

                updateTooltip(totalPresets);
            } else {
                alert('더 이상 프리셋을 추가할 수 없습니다.');
            }
        });

        // 프리셋 제거
        document.getElementById('remove-preset-button').addEventListener('click', function() {
            if (totalPresets > 1) {
                let presetData = localStorage.getItem('preset' + totalPresets);
                let hasData = false;
                if (presetData) {
                    presetData = JSON.parse(presetData);
                    // 필수 필드에 데이터가 있는지 확인
                    const projectName = presetData.projectName && presetData.projectName.trim();
                    const product = presetData.product && presetData.product.trim();
                    const cutName = presetData.cut_name && presetData.cut_name.trim();

                    if (projectName || product || cutName) {
                        hasData = true;
                    }
                }

                if (hasData) {
                    if (confirm('Preset ' + totalPresets + ' has data. Do you really want to delete it?')) {
                        localStorage.removeItem('preset' + totalPresets);
                    } else {
                        return;
                    }
                } else {
                    // 데이터가 없으면 확인 없이 제거
                    localStorage.removeItem('preset' + totalPresets);
                }

                let button = document.getElementById('preset-button-' + totalPresets);
                presetsContainer.removeChild(button);
                if (currentPresetNumber === totalPresets) {
                    currentPresetNumber = 1;
                    loadPreset(currentPresetNumber);
                }
                totalPresets--;
                updateCurrentPresetDisplay();
            } else {
                alert('최소 하나의 프리셋은 있어야 합니다.');
            }
        });

        // 현재 데이터를 현재 프리셋에 저장
        function saveCurrentToPreset() {
            // 필드 값 가져오기
            const projectName = document.getElementById('projectName').value.trim();
            const product = document.getElementById('product').value.trim();
            const cutName = document.getElementById('cut_name').value.trim();

            // 필드 검증
            if (!projectName || !product || !cutName) {
                displayPresetMessage('No data to save.', false);
                return;
            }

            // 현재 버전 상태 및 버전 번호 가져오기
            const versionState = document.getElementById('version-state').value;
            const versionNumber = document.getElementById('version').value;

            // 기존 프리셋 데이터 가져오기 또는 새로 생성
            let presetData = localStorage.getItem('preset' + currentPresetNumber);
            if (presetData) {
                presetData = JSON.parse(presetData);
            } else {
                presetData = {};
            }

            // 프리셋 데이터 업데이트
            presetData.projectName = projectName;
            presetData.product = product;
            presetData.cut_name = cutName;
            presetData.colorspace = document.getElementById('colorspace').value;
            presetData.x_resolution = document.getElementById('x_resolution').value;
            presetData.y_resolution = document.getElementById('y_resolution').value;
            presetData.product_type = document.getElementById('product_type').value;
            presetData.founder = document.getElementById('founder').value;
            presetData.version_state = versionState;

            // 버전 상태에 따른 버전 번호 업데이트
            if (versionState === 'prev') {
                presetData.version_prev = versionNumber;
            } else if (versionState === 'final') {
                presetData.version_final = versionNumber;
            }

            localStorage.setItem('preset' + currentPresetNumber, JSON.stringify(presetData));
            displayPresetMessage('Preset ' + currentPresetNumber + ' saved.', true);
            updateTooltip(currentPresetNumber);
        }

        // 메시지 표시
        function displayPresetMessage(message, isPositive) {
            const presetMessage = document.getElementById('preset-message');
            presetMessage.textContent = message;
            
            // 테마에 따른 색상 설정
            const theme = document.documentElement.getAttribute('data-theme');
            if (isPositive) {
                if (theme === 'dark') {
                    presetMessage.style.color = '#FFFFFF'; // Dark 모드에서 흰색 글씨
                } else {
                    presetMessage.style.color = '#000000'; // Light 모드에서 검은색 글씨
                }
            } else {
                presetMessage.style.color = '#FF6666'; // 부정적인 메시지는 빨간색
            }
            
            // 페이드 인
            presetMessage.style.opacity = '1';
            // 5초 후 페이드 아웃
            setTimeout(() => {
                presetMessage.style.opacity = '0';
            }, 5000);
        }

        // 프리셋 데이터 로드
        function loadPreset(presetNumber) {
            currentPresetNumber = presetNumber;
            updateCurrentPresetDisplay();
            let presetData = localStorage.getItem('preset' + presetNumber);
            if (presetData) {
                presetData = JSON.parse(presetData);
                document.getElementById('projectName').value = presetData.projectName || '';
                document.getElementById('product').value = presetData.product || '';
                document.getElementById('cut_name').value = presetData.cut_name || '';
                document.getElementById('colorspace').value = presetData.colorspace || 'srgb';
                document.getElementById('x_resolution').value = presetData.x_resolution || '';
                document.getElementById('y_resolution').value = presetData.y_resolution || '';
                document.getElementById('product_type').value = presetData.product_type || 'cgi';
                document.getElementById('founder').value = presetData.founder || '';
                document.getElementById('version-state').value = presetData.version_state || 'prev';

                // 버전 상태에 따른 버전 번호 설정
                const versionState = document.getElementById('version-state').value;
                let versionNumber = 1;
                if (versionState === 'prev') {
                    versionNumber = presetData.version_prev || 1;
                } else if (versionState === 'final') {
                    versionNumber = presetData.version_final || 1;
                }
                document.getElementById('version').value = versionNumber;

                displayPresetMessage('Preset ' + presetNumber + ' loaded.', true);
            } else {
                displayPresetMessage('No data in preset ' + presetNumber + '.', false);
                // 데이터가 없으면 필드 초기화
                document.getElementById('projectName').value = '';
                document.getElementById('product').value = '';
                document.getElementById('cut_name').value = '';
                document.getElementById('colorspace').value = 'srgb';
                document.getElementById('x_resolution').value = '';
                document.getElementById('y_resolution').value = '';
                document.getElementById('product_type').value = 'cgi';
                document.getElementById('founder').value = '';
                document.getElementById('version-state').value = 'prev';
                document.getElementById('version').value = 1;
            }
        }

        // 버전 상태 변경 처리
        document.getElementById('version-state').addEventListener('change', function() {
            const versionState = this.value;
            let presetData = localStorage.getItem('preset' + currentPresetNumber);
            let versionNumber = 1;
            if (presetData) {
                presetData = JSON.parse(presetData);
                if (versionState === 'prev') {
                    versionNumber = presetData.version_prev || 1;
                } else if (versionState === 'final') {
                    versionNumber = presetData.version_final || 1;
                }
            }
            document.getElementById('version').value = versionNumber;
        });

        // 버전 번호 실시간 업데이트
        document.getElementById('version').addEventListener('input', function() {
            // 업데이트된 버전 번호를 프리셋 데이터에 저장
            const versionNumber = this.value;
            const versionState = document.getElementById('version-state').value;
            let presetData = localStorage.getItem('preset' + currentPresetNumber);
            if (presetData) {
                presetData = JSON.parse(presetData);
            } else {
                presetData = {};
            }

            if (versionState === 'prev') {
                presetData.version_prev = versionNumber;
            } else if (versionState === 'final') {
                presetData.version_final = versionNumber;
            }

            localStorage.setItem('preset' + currentPresetNumber, JSON.stringify(presetData));
        });

        // 현재 프리셋 리셋
        function resetCurrentPreset() {
            if (confirm('현재 프리셋의 모든 데이터를 삭제하시겠습니까?')) {
                localStorage.removeItem('preset' + currentPresetNumber);
                displayPresetMessage('Preset ' + currentPresetNumber + ' reset.', false);
                updateTooltip(currentPresetNumber);
                // 필드 초기화
                document.getElementById('projectName').value = '';
                document.getElementById('product').value = '';
                document.getElementById('cut_name').value = '';
                document.getElementById('colorspace').value = 'srgb';
                document.getElementById('x_resolution').value = '';
                document.getElementById('y_resolution').value = '';
                document.getElementById('product_type').value = 'cgi';
                document.getElementById('founder').value = '';
                document.getElementById('version-state').value = 'prev';
                document.getElementById('version').value = 1;
            }
        }

        // 모든 데이터 리셋
        function resetAllData() {
            if (confirm('모든 데이터와 프리셋을 삭제하시겠습니까?')) {
                localStorage.clear();
                displayPresetMessage('All data reset.', false);
                // 프리셋 번호 초기화
                currentPresetNumber = 1;
                totalPresets = 1;
                initializePresets();
                // 필드 초기화
                document.getElementById('projectName').value = '';
                document.getElementById('product').value = '';
                document.getElementById('cut_name').value = '';
                document.getElementById('colorspace').value = 'srgb';
                document.getElementById('x_resolution').value = '';
                document.getElementById('y_resolution').value = '';
                document.getElementById('product_type').value = 'cgi';
                document.getElementById('founder').value = '';
                document.getElementById('version-state').value = 'prev';
                document.getElementById('version').value = 1;
            }
        }

        // 변환 및 복사 기능
        function convertAndCopy() {
            // 입력 검증
            const projectNameInput = document.getElementById('projectName');
            const productInput = document.getElementById('product');
            const cutNameInput = document.getElementById('cut_name');
            const founderInput = document.getElementById('founder');

            if (!projectNameInput.checkValidity() || !productInput.checkValidity() || !cutNameInput.checkValidity() || !founderInput.checkValidity()) {
                alert('Project Name, Product, Cut Name 필드에는 영어와 숫자만 입력 가능합니다. Founder 필드에는 영어만 입력 가능합니다.');
                return;
            }

            let versionNumber = document.getElementById('version').value;
            let versionFormatted = 'v' + ('000' + versionNumber).slice(-3);

            // 필드 수집
            const fields = [
                document.getElementById('projectName').value,
                document.getElementById('product').value,
                document.getElementById('cut_name').value,
                document.getElementById('colorspace').value,
            ];

            const x_resolution = document.getElementById('x_resolution').value;
            const y_resolution = document.getElementById('y_resolution').value;

            let resolution = '';
            if (x_resolution && y_resolution) {
                resolution = x_resolution + 'x' + y_resolution;
            } else if (x_resolution) {
                resolution = x_resolution;
            } else if (y_resolution) {
                resolution = y_resolution;
            }

            if (resolution) {
                fields.push(resolution);
            }

            fields.push(
                document.getElementById('product_type').value,
                document.getElementById('founder').value,
                document.getElementById('version-state').value,
                versionFormatted
            );

            // 빈 필드 제거
            const nonEmptyFields = fields.filter(field => field && field.trim() !== '');

            let result = nonEmptyFields.join('_') + '.####';

            document.getElementById('result').textContent = result;
            // 클립보드에 복사
            navigator.clipboard.writeText(result).then(() => {
                // 복사 성공 메시지 표시
                const copyMessage = document.getElementById('copy-message');
                copyMessage.style.display = 'block';

                // 버전 번호 증가
                let versionInput = document.getElementById('version');
                let versionNumber = parseInt(versionInput.value);
                versionNumber += 1;
                versionInput.value = versionNumber;

                // 업데이트된 버전 번호를 프리셋에 저장
                saveCurrentToPreset(); // 여기에서 프리셋 자동 저장

                // 2초 후 메시지 숨김
                setTimeout(() => {
                    copyMessage.style.display = 'none';
                }, 2000);
            });
        }

        // 툴팁 내용 업데이트
        function updateTooltip(presetNumber) {
            let tooltip = document.getElementById('tooltip-' + presetNumber);
            let presetData = localStorage.getItem('preset' + presetNumber);
            if (presetData) {
                presetData = JSON.parse(presetData);
                tooltip.innerHTML = `
                    Project Name: ${presetData.projectName || ''}<br>
                    Product: ${presetData.product || ''}<br>
                    Cut Name: ${presetData.cut_name || ''}
                `;
            } else {
                tooltip.textContent = 'No data';
            }
        }

        // 툴팁 표시
        function showTooltip(presetNumber) {
            updateTooltip(presetNumber);
        }

        function hideTooltip(presetNumber) {
            // CSS에 의해 자동으로 숨겨집니다
        }

        // 프리셋 초기화
        initializePresets();

        // 테마 전환 로직
        const themeToggle = document.getElementById('theme-toggle');
        const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
        let currentTheme = localStorage.getItem('theme');

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            if (theme === 'dark') {
                themeToggle.textContent = 'Dark mode';
            } else {
                themeToggle.textContent = 'Light mode';
            }
        }

        if (currentTheme) {
            setTheme(currentTheme);
        } else {
            if (prefersDarkScheme.matches) {
                setTheme('dark');
            } else {
                setTheme('light');
            }
        }

        themeToggle.addEventListener('click', function() {
            let theme = document.documentElement.getAttribute('data-theme');
            if (theme === 'dark') {
                setTheme('light');
            } else {
                setTheme('dark');
            }
        });

        // 시스템 테마 변경 감지
        prefersDarkScheme.addEventListener('change', (e) => {
            if (!localStorage.getItem('theme')) {
                if (e.matches) {
                    setTheme('dark');
                } else {
                    setTheme('light');
                }
            }
        });

        // 페이지 로드 시 데이터 로드
        window.onload = function() {
            // 결과 영역 초기화
            document.getElementById('result').textContent = '';
            loadPreset(1); // 기본으로 프리셋 1 로드
        };
    </script>
</body>
</html>
